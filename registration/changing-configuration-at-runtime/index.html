<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>StructureMap - Changing Configuration at Runtime</title>
        <link href="/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
        <link rel="icon" type="image/x-icon" href="/content/images/structuremap-logo.ico">
        <link rel="icon" type="image/png" href="/content/images/structuremap-logo-60x60.png">
        <link rel="apple-touch-icon" type="image/png" href="/content/images/structuremap-logo-60x60.png">
        <link rel="apple-touch-icon" type="image/png" sizes="72x72" href="/content/images/structuremap-logo-72x72.png">
        <link rel="apple-touch-icon" type="image/png" sizes="114x114" href="/content/images/structuremap-logo-114x114.png">
        <link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/content/images/structuremap-logo-144x144.png">

        <!-- CSS code from Bootply.com editor -->
        <link href="/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <!-- HTML code from Bootply.com editor -->

    <body  >

<a href="https://github.com/structuremap/structuremap"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

        <nav class="navbar navbar-default navbar-fixed-top" role="banner">
          <div class="container">
            <div class="navbar-header">
              <a href="/" class="navbar-brand">StructureMap 4.5.0</a>
            </div>
            <nav class="collapse navbar-collapse" role="navigation">
              <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/quickstart">A Gentle Quickstart</a>
            </li>
                <li>
                  <a href="/documentation">Documentation</a>
                </li>
            <li>
              <a href="https://groups.google.com/forum/#!forum/structuremap-users">Google Group</a>
            </li>
                <li>
<a href="https://gitter.im/structuremap/structuremap?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/structuremap/structuremap" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
                </li>
                  <li><a href="/registration/policies" title="Construction Policies">Previous</a></li>
                  <li><a href="/registration/on-missing-family-policies" title="On Missing Family Policies">Next</a></li>
              </ul>
      <div class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input id="search" type="search" class="form-control" placeholder="Search">
        </div>
      </div>

            </nav>

          </div>
        </nav>

          <div class="container">
              <nav class="navbar-inverse">
                  <ol class="breadcrumb"><li><a href="/">StructureMap</a></li><li><a href="/registration">Registration</a></li><li class="active">Changing Configuration at Runtime</li></ol>
              </nav>
          </div>

        <!--main-->
        <div class="container">
            <div class="row">
              <!--left-->

              <div class="col-md-3" id="leftCol">
                <ul class="nav nav-stacked affix" id="sidebar">
                    <li><h3><img src="/content/images/structuremap-logo-210x210.png" alt="StructureMap 4.5.0" width="210" height="210"></h3></li>
                    <li><h3 class="no-margin">Next</h3><p><a href="/registration/on-missing-family-policies">On Missing Family Policies</a></p></li>
                    <li><h3 class="no-margin">Previous</h3><a href="/registration/policies">Construction Policies</a></p></li>
                </ul>

              </div><!--/left-->

              <!--right-->
              <div class="col-md-9">
                      <h1>Changing Configuration at Runtime <a href="https://github.com/structuremap/structuremap/blob/master/documentation/registration/changing-configuration-at-runtime.md"  class="text-muted small pull-right fa fa-github" style="margin-top: 10px"> Edit on GitHub</a></h1>

                      <hr />

                      <div id="main-pane">
                          <!--Title: Changing Configuration at Runtime-->
<!--Url: changing-configuration-at-runtime-->
<div class="alert alert-info" role="alert">Use the technique shown here with caution.</div>
<p>If you need to add or change configuration to an existing StructureMap <code>Container</code> object, you can use the <code>IContainer.Configure()</code> method
to add or change your container at runtime as shown below:</p>
<pre><code class="language-csharp">&#xD;&#xA;[Fact]&#xD;&#xA;public void change_default_in_an_existing_container()&#xD;&#xA;{&#xD;&#xA;    var container = new Container(x =&gt; { x.For&lt;IFoo&gt;().Use&lt;AFoo&gt;(); });&#xD;&#xA;&#xD;&#xA;    container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;AFoo&gt;();&#xD;&#xA;&#xD;&#xA;    // Now, change the container configuration&#xD;&#xA;    container.Configure(x =&gt; x.For&lt;IFoo&gt;().Use&lt;BFoo&gt;());&#xD;&#xA;&#xD;&#xA;    // The default of IFoo is now different&#xD;&#xA;    container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;BFoo&gt;();&#xD;&#xA;&#xD;&#xA;    // or use the Inject method that&#x27;s just syntactical&#xD;&#xA;    // sugar for replacing the default of one type at a time&#xD;&#xA;&#xD;&#xA;    container.Inject&lt;IFoo&gt;(new CFoo());&#xD;&#xA;&#xD;&#xA;    container.GetInstance&lt;IFoo&gt;().ShouldBeOfType&lt;CFoo&gt;();&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;</code></pre>
<h2 id="best-practices">Best Practices</h2>
<p>First off, the best advice on this functionality is <em>don't use it outside of testing scenarios on the root container</em>. The <code>Configure()</code> method has to use a threading lock around the internal object model of a StructureMap container and can cause serious contention at runtime if you try to override services in the main application controller. Some frameworks (looking at you NancyFx) have abused this functionality quite badly in the past and the result was not pretty.</p>
<ul>
<li>Do favor writing configuration to StructureMap <code>Registry</code> objects, then applying that <code>Registry</code> to a container rather than repeatedly calling <code>Configure()</code></li>
<li>Do not call <code>Configure()</code> on the main application container after the initial configuration. Use nested or child containers that are not shared across threads or HTTP requests if you need to override services at runtime</li>
<li>There's a potential performance hit from using <code>Configure()</code> at runtime because StructureMap has to recycle its internal <em>Build Plan's</em> based on
the potential new configuration.</li>
</ul>

                      </div>

                      <hr />

                      <nav>
                        <span>
                            <strong>Previous: </strong><a href="/registration/policies">Construction Policies</a>

                        </span>
                        <span class="pull-right">

                            <strong>Next: </strong><a href="/registration/on-missing-family-policies">On Missing Family Policies</a>

                        </span>
                      </nav>

              </div><!--/right-->
              </div><!--/row-->
        </div><!--/container-->


    </body>


    <foot>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/content/embed.js"></script>
        <script type="text/javascript" src="/content/prism.js"></script>
        <script type="text/javascript" src="/content/sidebar.js"></script>
        <script type="text/javascript" src="/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:structuremap.github.io ' + search;
    url = encodeURI(url);

    //alert(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }



});

</script>
    </foot>
</html>

